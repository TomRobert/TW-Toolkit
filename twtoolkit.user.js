// ==UserScript==
// @name         The West - Toolkit
// @version      1.58
// @description  Useful tools for The West
// @author       Thathanka Iyothanka
// @include		   http*://*.the-west.*/game.php*
// @include		   http*://*.the-west.*.*/game.php*
// @license      GPLv3 - http://www.gnu.org/licenses/gpl-3.0.txt
// @copyright    Copyright (C) 2015, by Thathanka Iyothanka <thathanka.tw@gmail.com>
// @grant        none
// @homepage     https://thathankatw.github.io/TW-Toolkit/
// @downloadURL  https://thathankatw.github.io/TW-Toolkit/twtoolkit.user.js
// @updateURL    https://thathankatw.github.io/TW-Toolkit/twtoolkit.user.js
// @supportURL   https://github.com/thathankatw/TW-Toolkit/issues
// ==/UserScript==
/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */
(function (fn) {
  var script = document.createElement("script");
  script.setAttribute("type", "application/javascript");
  script.textContent = "(" + fn + ")();";
  document.body.appendChild(script);
  document.body.removeChild(script);
})(function () {
  TWBattleToolkit = {
    scriptName: "The West Battle Toolkit",
    version: 1.58,
    gameMAX: Game.version.toString(),
    author: "Thathanka Iyothanka",
    gameMIN: "2.0",
    website: "https://thathankatw.github.io/TW-Toolkit",
    updateURL:
      "https://thathankatw.github.io/TW-Toolkit/files/last_version.txt",
    setsURL: "//tomrobert.github.io/TWIR/json/set_list.json",
    chartURL:
      "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js",
    langs: {
      base_url: "https://thathankatw.github.io/TW-Toolkit/langs/",
      fr_FR: "fr_FR.json",
      en_US: "en_US.json",
      de_DE: "de_DE.json", //Thanks to Tom Robert
      pt_PT: "pt_PT.json", //Thanks to LoMexicano and capitao.cesar
      pt_BR: "pt_PT.json", //Thanks to LoMexicano and capitao.cesar
      pl_PL: "pl_PL.json", // Thanks to Wojcieszy
      it_IT: "it_IT.json", // Thanks to Huyana
      es_ES: "es_ES.json", // Thanks to pepe100
      hu_HU: "hu_HU.json", // Thanks to Ördögh Vilmos
      hodor: "hodor.json", // Thanks to Wojcieszy
      ru_RU: "ru_RU.json", // Thanks to Anton
      cs_CZ: "cs_CZ.json", // Thanks to JamzaSK
      bg_BG: "bg_BG.json", // Thanks to Wolverstone George
      el_GR: "el_GR.json", // Thanks to Μάταιος Φρουρός
      sv_SE: "sv_SE.json", // Thanks to Melkor
      sk_SK: "sk_SK.json", // Thanks to JamzaSK
      tr_TR: "tr_TR.json", // Thanks to JohnCooper
    },
    icons: {
      crithits:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAIAAAC0D9CtAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAKNSURBVDhPfZPNTxNBFMBn9rvbL9bSsnAglGLwA2OCUj8IJl49GA56II2pB0PSi4RE5aAJ3DASrwT9B0jUBEMMJEjCSYlGEkPlwoHSokCBAm13W7bbdnzT6UEP+svOm/cxb/J25g1+GhtACCUNIZfPO2RJlGQwAbtkVSwTFF52gtS8De7qkSQKoNMR3ylKyL58utlGqmnmwVMuHtGIKoLOFbZBfl1NguztaoU0fLu/v6NFezh4r2oXCvt7vvdz3sVlObULK0y9Id3Xlepuror8bqb49lvesKrXOgNcpVwOhs5CAt7cCMWe6a/fOTZ+ceUKfK7gudDKTvjlvHJoOlXRp3lOCkbJLnO8IBhGtpo90B89V5K0DAYZGEA3+vD6ums3e/HVkmWWbF5lIQ6GbaSdbz78lTAygoaH8YsJZrrT2fYvCbFSYCYHfw+TZ+EzsxHPk8lJPDaG7keRTUOMUJyeAYMrWSWYlJ9pajmdZGYGx2JIEPDHRbS2hmZnUVMTRLT9LF1Qg9ZGIYRKrxdPTaFolORzqKWF2DYZGkLp2nZ/UM8xdI1O29tobo5IEtZOkelp3NuLE4laHB01epgCcBVexrnNvXAHs4muo/FxMvIERyLIpH3AWD/fVtcgxyGQzPFJ6nrQ0L3UMTqKIhF6YqzaGsd+T/xSfVOgXhvc9PfBm/nwBTQxgRcWmJMBCfN3wkjm6zYcbXfP1czOViDgsxzqZrv7xDQU05KKJcLhTKBh9cqZpVs9OdV9XBSX4wmt0e93ifjxg7uffqQU1eX3+2AP6GvoaEHmylYV+hpuQpIlaO2tZBLWdDYpLqdK3wK00MrG4f4e7ct/0doWbHUTURHdiqP+fgDIZMp/oO8Hod/QgQVXD60mfgAAAABJRU5ErkJggg==",
      playdeadcount:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAIAAAC0D9CtAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJySURBVDhPfZPPaxNBFMd3dmdmf5htGpvUtmlLLKnF0FNJC6L5A/RQiuBBsD0KXgQ9iKB4EC969aDoVT3o1V8gHiyKVYzQKiIp9GdMm6T5tclms7vZXd+wQYNQP+y8+c7Me2/fzs6gaxfOchy32cBavS6LlFARhoBtmY6pgxDEA2BDwV7VrVCCQbP2bcegnJ0cH7Q5RdfrMNM2KmxFIaD5Zg7s55VNsMcnRyEMzc7NxYdCF8/Pu3ZT16pqKHxwJCEH+8GjXtjYWn5TXF0CvVsynn2pN0z32ES/EI/Hp6eS4yO9TksLRY8MJVJU6eF5AR5J7Ts0PsPzuJL94SG0rZF8YS8aVnkB40ajBgFYDkbGpiDlP8SmZ3uGJ5uWYwuKP8NDsxt5s6WHohMIoVL2Z2F9xV/b2/peXF8GEZs6aTqYOE1/HsPXQ2eVy0rvQCWXWXx0Q6J45sx1KGDp6S0oMXn6KtTse/vwlmlB17JrWFSgdIkSDiGBiDymgiBwHMJUwkTyvX3YXgNGrQA2ODB2YuE2CDU8DDa1cMfzXDU8wjy6YN8DmLbrC/D2A4BAX/RPQNv1fAHwjiAibUMkneD9cDo5GbyMvVK15doGDPTKjueyRcvQzKYGwvM8rfSLOXbxN31+9dO7B5fTL+/p1cLik5uv7l+pl3JfXz98fvdSJv1W6KoDnZufN7Irp1JHAzJFrmG1Wd2aCTvG2R5PEHstiEYLv/iYCYUjiQEZD4qtD4b0+H0xEumDFIRKcKKxiNqm65ga/AkqUjja25trkhIYVVlGdhcsu51eKxcLuzDej9HYYQggElEluXN/AIj0xX9g94fjfgNTw/ZOJuuzRAAAAABJRU5ErkJggg==",
      totaldmg:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAG2UExURewbJOwbJewdJe0dJ+0dKO0eKO0cJOsaJfIeJv4kKfwRIP0KG+wcJPIeJP8lJPEcIO4YHu0bJe4bJP8lJfQbHu4cJO8aIesfKe0dJu4bI+0dJfMSGO4cI/8AAP0FCPwHCPkLDu0bIvAeJu0dI+0bI/AfJu0aI+wfJe8XIvAcJO4dJe8bI/IYIe4dJPAbIe4bIe8eJvAUHfEXHvAYJewcI+0aIuoVKuscI+scJPMZHPMZHvAXJO0dJe0cJPwLHe8aJewcJO4ZH+0cJO0bJe0bI+0cJe0cJO4cJOwcJOwbJewbJfEdI/IYHe8aIe0cJOwcJOweJuweJuwdJe0cJOwbJO0aIe0cJO0cJO0dJfMSGPEVHO0cJO0bI+0dJO0cJO4cJO4bI+0bJO8aIfwFBu0cJO0cJO0bI+4cJO8dJO4cJO4aIvAaIe8aIfAfJe0dJO4bIu8bIu8dJO0cJO0dJO0cJO0bI+4cJO0cJO0cJOwfJe4bI+4bIe8bIe4cIu0cJO4cIvAbIe0bIu0bI+0ZJO4cI+4bJfISIu8ZJe8eJO0aIuoVKu4eJu4YH+4bIvQZHe0cJe0cJP///9fC3GwAAACPdFJOUwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADEQDbUTePELD+3sDUhbHANuhugLFrH5wHlV+CQfA6T8ZZfOnW9DHgWE96lGBK7bSBUd9/5ldca3/YWwlgkBFEeSc/QUInFMA2jtEj4RAgF6bD4LuZgJtgAAAAFiS0dEkQ8NvpoAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQffCh0QMyVkNoG+AAAA6UlEQVQY02NgYGRkZGJmYWW1sWUDAQagADsHJxe3nb0DiM8DFuDl4xdwdHIWBAIhiICwiIurm7uoqCibGIOHpxcjm7ePb7+fP5O4hKQYQ0BgUHBIaNiECW7hEeJSQAHpyKgJYBDtFiMjKSTGICsrFwsRmRAXn5CYBBRITgmDikxITUtnkJdXyMiEcLOycxRlGJSUlHLzIAL5BcoqMgyqqqqFRcVAbklpWWp5hRqDunpllUb1hJraunrNhsamZqCAupZ2S2ubTnuHrp5+ZxeDARCodvcYGhmbmOjpm5oxmAOBRW+fpZU1RAAAWP9FxOOwpA4AAAAASUVORK5CYII=",
      button:
        "data:image/png;base64,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",
      xmas:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAYAAACtv5zzAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AMWDA8tuI44eQAABOVJREFUSMft1T2MXFcVB/D/ufe9mXk7s19jswZbJGSRE2Q5hmApEkYosiyqAJKFJooSIqQYUVlKkQq6paKnixSlSJcWJV2UiFBSgBHEXpzY3p3M7ny+efM+7r3v3XtOKiRvAkgRTZD410fnd85pDvC/HvoixQKoyWCwVqSpvjuZ+NatW+4q4P9rQC5fjle7u7tC9JQRuWibZqNyLq2K4iAvivuz6fT234bD6R5Qf2Fg+eyz21Wn8xMSeR5El4LIRh2CKowJ8yyrx4tFOl8s/pRX1R9SY96+sb8/Pn/+/GmkaUH9fhb9p+YHg8G5zPuf+7p+GcAjWmtpQpBJmmK0WOhpmrayPN9wzu0G5h9GSfL08oMP7oXd3csh6d45vHPv/X8LTK5f/5phfsV4/xJ734+jiGvvMZpO+aOjI4wWC104J3UIXDNTDGz1QM8ff3jHuNL0mOValVeDfwmMB4OeZX7R1vVLtq77WimREDCez7F/eEgHaYpFXaMUgWOGAKEFUGdrR8v6Tq92jVSrPMqmi7OfA+SZZ6KRUtestTesc6eYmSOlsCoKHM3nNCsKMiIicQx4D2EGA0JxZ7h56UrQX3nksft/2Vfz0Vhs5eRzQLqzc7ap6xcqa79ZOscKgDBLUZZkrIXWGqeThJgZS2YsADSAjbX6/enHL8r4/uiX88NxmzlQd6NXnQBkMNDHwPeMtd9fGYPSGCRao93tQhMhVgr9dhsQQe09fBShaBqISE62evfU2Z1PGs/roWkuKVJJlLT+egKYJ8lXydrrtfdnfNNwojW2u12sJYkyxmAtiqCYYUKAEYEVQQCoAaYEfDz41S/+/s7rb/26mhVbXnGb2nEWiYgC8BiyDMubN5803v+AQ5Cu1qKJ4JoG89WKp8slpcZQ5T3SukZW1zDewwLBAbdavd5EioLoxnNTANN/Dh0BOA3gVQbOuFOnQjEabbmyDMs8p9QYzJyTpbVSeU+WGTYEWO/hRQTM4gDWvV7609/87om3W/EQN3/24OGrKAAXAFwT4Ee4cOHHqzNn2g+Y9Yd5TnfSlA6yjIZlqY6tReqcrJyD814kBAkioE6iHr9y9QoJ/dYa/8J7b7zReRiIAKwBWNPr67o/GKj21au0fvu2Pnd8LIvhEOmDBzIZj1GVpdg8Rzqbw1hDcbstcWedzl78jjr3re9+O5ssNQGTmnt9AKOHgUcBdKFUiLe3ZWNzU3qPfoOcMbCVhZIgriph8oK8c3T08QE+uXufIARTeolaayizKrZm4VuddtHtdO1nN3gawAYzs1JKlFIcEFCbGtlkSWubPels9uEcYaO/Q41vYXZsqcoKVZtVWM1nkCCKIsVN0xynR8OTQAhhX5iXvvFbWmvFLFI7x03TgEOALQyRgjhjMB9NMPrHgRx/NIT3DYsPICIgUsIchIDCrqXhBKC1ftPY+usmL16EkGpcrX3TtOJ2CyCgqWtBLlIsVpgejskWRgAGCQRKERGxEAJpOgTUvUW/Hz57ohGDX4PSk7qqVJ6uuq60u0k32crnS66KqlVlZTcdTpbOusAc2nGrRUpxTJpWIYRDQFYs6o+1te/t7e2d+HARETGAP4/H47vcUhyqVM+yprvNTVKmZVgtZ53F0WrTTFez0Lg6+CZpba4rFeu2asPQQqYAMHrN5HvYY/w/X7p8CvAJR/nwyl29AAAAAElFTkSuQmCC",
      easter:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAYAAACtv5zzAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AMWDA82MuvxlQAABVZJREFUSMfdlttrXFUUxn/nMmfO3CfTJJNbM0knqanNGLSt2rRWbb20UhERq6iIohQEURQFQV/FC/ggCiqIgqAPPvjghXqjarXWNtE2SWubmMZcmphMLnOfM3Nm5hxf9tRpCP0D3LA5bDbn+9a31t7f2hJrDxlQAAfgBFxiamLPBkygABjiWwLKYs+uAqmXAdcAN+AXMyDWKlARwBkgCaSBvPi/fDkCSRBogAeoAxqam+vbDz6y+6ab+7u2hwNSuIiWOnFqZuDt9747PHxmalwolWqiv6hCWUVQTYsbCAFNvb0dvW++/uATB3Z77gwr042SMeVx5udCV3X6Y7tu3bFpYclYGv1rLi0iLwt11loEkli7RDoam5qC3e++9eiT/Xusa4IBGxdpDkdmGQksEhlZJOVaWdeze1v39Fj675mZxZSoi1lbC3VV7h01BOEXXrz37u23aX2m2kqZeS74bCbxM9VgInsNppbGWTat9see33vf0NDEP9mskRO1MYWSiwqq0etAEAjv3b/1uoMv9d/f6A3rOvWYFMiQQiNOfcmm6NJAlpnJxKm0ehsjxfb4yRNjM6LYRaHCUlcROAGvoiihR/ZvvSHmcATIeaFk4JgyiY5UiE6qoLeBOwi2BfFxznhmtPlr+3Z+omu/FQrmsjhdBaCsriqwDnh7t2yMXNfR2Jsr+vB4bcBi0N/GhXATXitH2FtP0OXBlc5STnfTMjrGuuZA16039nV98c3ALJAQJ9RUa/KvCgXuvr07Yh/27GxUQ05iSpIJd4iPO6/kz3CIiAT9MjQrEC/DH4bN4kqCPfKcLzZfjH3xzcCAwFEBSa5JkVq9XF2b1nc0aEvSR3TxNDs4L1V42f6SB9wThICIAtES3KEneL/uKL3RAvFsifWxjmjNjVcBWV5VAwegbWmTmh72nia+LDGddPA4v7C3HOd1xtmmQ4cFvU64hQRXs8A7/EHa5SHaqjSJ6B0C7xIFVYtQ2wOyP2talJNZKJVw2gaU80hUCAJ1EvhtkIWD+Chhuj0UVU0XkSsCU1LXsAl52AppP690YKXzkKvwkP9uXtSGOEs36QIUVVixIK0EcBHhU9xYywnO6i1VnCrWJV500UMWlh3WuTkXgXYFnBonpwI8rF3B7W6VLm+ZhKzSpsCy5eDHfDffZ4s0GNM4Snatk9q1BLbwjwpQ3jl4PHVw8HTY46oHVYdEAkwTOiKwoRM2dEOoHkyTfbOzMDwEi7NM3nJl8Zn/PMmqtQpbgJtA8azO/EiPujFm/IovKBPK5QjkwRmYAVcSnDJ4ATMNwSPMt48w1uUj4ykkxC0uCbxLCMqCIDcwnzlvxUK73kjprPQtEOiSWK/X0a66iTpNonKSdSRZYZEjxQVOXyjRXaqj+XBuXFjFRcNbTVAAsse+PXXq1Zbd81t/mGyKHc2gbWhCUSUcuSQ+pYgnYOB0X6BSLrBnIcXSvAPp5ub0s18OHweyVZuo9aJagszvv4+On7hz25HOjdEDyZ8y9KTyhPIG7kwGNA38WWzPJCkUkpJCdksPo0n5+FeHBs+I7maspaBSJQCW3vrg0FdPvXbPhqPy5q1j+VGWIwZyUMXhL6MqGdScC7UQoKM1ymYlevbD5z7/DFgUBFUFtrJGy7QBsimjNHFubmrXvi3+hrpwGyu6XDa8WNk6lHQDIed6NrVustsyLYMfvfLtB8ODE6eBOJCqTZG0Rker9uMg0OANuFr23XX9tdu3b+5HtzsNu6DLqmyqJWV26Lfzx77+/PixpYX0tIg+AeTESaoAtnSZF4UL8NW8KHzCztWadGZFxOma3Bdr+vL/YPwLkyIleQSxMyIAAAAASUVORK5CYII=",
      independence:
        "data:image/png;base64,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",
      dotd:
        "data:image/png;base64,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",
      oktoberfest:
        "data:image/png;base64,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",
      valentine:
        "data:image/png;base64,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",
      sale:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAYAAACtv5zzAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AMWDA8SDugVRAAABVFJREFUSMftldtrXPcRxz/ndy57ztn7rnYlraW1V1YkrWqlrmUb1zi1c2ltnJCQghsKLTQvpg+9UGhf+lLyUigtlEL7UgJ9amjqQppCQklbYxGKG2O7VmM7lryRLUvWrlYrabWXs3v23PoQrOA4jv+BfJ+GGZgPM8PMwOd6hKSH+MXpaeTBCKG8gREITNnFkFUUx8N3wHYF7Xad9sU69pnrOEDwaYmUTzqOgnLqKLpmkEgrZDWNgZgQwwklyGkQcQNsK5DKK7Y/XzFZmFRZOwqtGfA+DXIf4PQ06l6DSDrOYEqRi2M6JxOa8bSIDeScaEb1NRPJcxDWVlBsVDbXG7XfvbnkvWqM0qGE95kVnDqFXKwSTkXI7zKUw1/QxU9aw0d2lR8/IEWGwJNs6s0O8bCGqmjS/N/Op6ZaG0/7mvd6vcvaw2awDThYR8/F6d9tiiNFQ3/l9vjX0tWsg7v1b2bfWCRbrpLTvOCaZkpDLx2gNvs+zWiw7HrEin1EvjwEbQd38xL+GfDvtWsbkPCIhGUK4yHtBzd2Ppleja0genD1zRu8nLTstZx3RRcYfT338bmFVcalrrPkePWBMBMJBUUS1LqwZR2mWVXpzMzg3geI6KQe0+XjdSM31shZGKrOrdkyLxjt3pWO/9fbbe/6sCEN5FVvcvPdBWV8UEhdoT1b0Pw9ru+Vk5o+UOn2Xvun57413mBthk8AQoJ0vywdm0v0kegzCQIwSpfRY5RmV7zzLYdyxpT84TCNr+85kiqPP6MEofAOqTy3Q6uVuDOwl5F3fzUVDfE/r0MTsO4D6BpJTZILZGMkEkm6rS4j2CzZ3gdNm5X+MN4TUeUbC4XnUkvTLyOHInStFiI/glIQ2Fdn2BWgaYKsHmLhgSErEoblBHIiEyGRTNL2m6DBXV9qIeHv1MWQR2jiv9F9OOUqVuUCkX/9Gl8otL7yXeKmTtNBCQtSOqjbG3vPcH0cmcB3HI9w2CQSj4AkiCpBtt9kOBqSChutnlBjaSJhk1wyzNHDB/jmbshf/TOqbuIF0AtQLRn5gQoaHnVJpVy9uRIrPrmXcCrGVn6c4vr1Q45wbV0O9Ljn468u0H/oBEEmw+LENKu1m0jn/kT57GuEo0G93cL13Y8B28bxArEdhhixyltTQXEEIUFsNMfaRsQYDdyxtBLKa9GUsmhrkheKUyhO0bs7R6AaDH/1WxSo0bc6K1Zs/0KlEZTOVz5avm3AsTyK5fv1/bHgS+/8fa7PG0hgxhUYirBZKEqtiX3KfGa3FN//baq/+Q5Xrlxm/KkXyT82iR5LEp44ROmd15VBtbV0sxNcnFmicl+LKl0aumDuvYb3i+eznR9f/uPbY2+Fkgp9cTxZRu50qa4qfP/3PyIxtpMx5wLnXjmO/71X2Xn4JEIKcbsTYr8hheXg4yu9DThr0z3YpNJL+v+p2f5PR6PSwRe1zWOiu7kDgRESqMumnCwv3UE+/QfmZ99m1N6gHUuzuVmnWauQdSqsK8HdjoPzAODSJVymadmrLA9maVWsYOmy6pxTZOKmyuCBmDjhxoZO1lo9qvMfEkntw4zEcC2X9XP/oP7GL3kpZd86U/XOb3k0H/ZwJEBMgpzJoGUyaIqHPhon88KwciLkqz+/tBUSB+PtYN2WpVttFVMJmIr3/KThXzu77v/2Rt2/eG2Z239ZZuOzPtq9mATIP/wi4T0ZBp9IK8/LUpBfdPwNUxLJsCDmBFgrneDDxa4/V7O4M9egfLFLvVTCfhRgG/SzSVQjh4FDtBcQxccUAaoDOD1cW8Ky2jRXWjSvLdIpgcNHJ/tzPVr/B3fyNgpbPRd8AAAAAElFTkSuQmCC",
      analyzer_button:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAyCAYAAACpgnCWAAAACXBIWXMAAAsTAAALEwEAmpwYAABAPGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDplNWIwOWRiYi01ZWEyLTExZTktYjRmOC1kYTQzZjE2NWQ3ZDY8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6Mjc0MGNjYmMtZTkxOS0yMTRkLTg5NjktN2M2OTRjZjJjOTc2PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPjFBNEU5RkI1MjUyRjU0RjM5MzEzNEI0NDBDNDJFNkFCPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDpiNTIxMDc5Yy0yYjYzLTJkNDMtODljYi1jOTJkYWVjNGU2YTg8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDQtMTRUMTI6NDg6NTQrMDI6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPmNvbnZlcnRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6cGFyYW1ldGVycz5mcm9tIGltYWdlL2pwZWcgdG8gaW1hZ2UvcG5nPC9zdEV2dDpwYXJhbWV0ZXJzPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+ZGVyaXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6cGFyYW1ldGVycz5jb252ZXJ0ZWQgZnJvbSBpbWFnZS9qcGVnIHRvIGltYWdlL3BuZzwvc3RFdnQ6cGFyYW1ldGVycz4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6Mjc0MGNjYmMtZTkxOS0yMTRkLTg5NjktN2M2OTRjZjJjOTc2PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA0LTE0VDEyOjQ4OjU0KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHhtcE1NOkRlcml2ZWRGcm9tIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgPHN0UmVmOmluc3RhbmNlSUQ+eG1wLmlpZDpiNTIxMDc5Yy0yYjYzLTJkNDMtODljYi1jOTJkYWVjNGU2YTg8L3N0UmVmOmluc3RhbmNlSUQ+CiAgICAgICAgICAgIDxzdFJlZjpkb2N1bWVudElEPjFBNEU5RkI1MjUyRjU0RjM5MzEzNEI0NDBDNDJFNkFCPC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICAgICA8c3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPjFBNEU5RkI1MjUyRjU0RjM5MzEzNEI0NDBDNDJFNkFCPC9zdFJlZjpvcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDwveG1wTU06RGVyaXZlZEZyb20+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDxwaG90b3Nob3A6SUNDUHJvZmlsZS8+CiAgICAgICAgIDxwaG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+CiAgICAgICAgICAgIDxyZGY6QmFnPgogICAgICAgICAgICAgICA8cmRmOmxpPjFBNEU5RkI1MjUyRjU0RjM5MzEzNEI0NDBDNDJFNkFCPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOkJhZz4KICAgICAgICAgPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE5LTA0LTEzVDIwOjM5OjM4KzAyOjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTktMDQtMTRUMTI6NDg6NTQrMDI6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA0LTE0VDEyOjQ4OjU0KzAyOjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpJbWFnZVdpZHRoPjEyNTwvdGlmZjpJbWFnZVdpZHRoPgogICAgICAgICA8dGlmZjpJbWFnZUxlbmd0aD41MDwvdGlmZjpJbWFnZUxlbmd0aD4KICAgICAgICAgPHRpZmY6Qml0c1BlclNhbXBsZT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGk+ODwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpPjg8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaT44PC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC90aWZmOkJpdHNQZXJTYW1wbGU+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpTYW1wbGVzUGVyUGl4ZWw+MzwvdGlmZjpTYW1wbGVzUGVyUGl4ZWw+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpFeGlmVmVyc2lvbj4wMjIxPC9leGlmOkV4aWZWZXJzaW9uPgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjY1NTM1PC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4yNTwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj41MDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+I7kpAgAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAOFElEQVR42kyXe5AdVZ3HP919+nHffWfmzp1XHpjJZAOTTAJEIoIQCQkaNQsbFdnCBRFwfdUqa+mq+6itWtetclfLtdgFN9YKugpEwBXYoMjyiJEEkxDIe5LJTGYmmdd93+7b794/7tRkT9Wprj6n6/c9v1//zu98jvSdrz8QHzt2jGJPH+Pj49Rti0Khh6bVQtM0tITRfioCz/OwrQau6yLHoCgKqirwfZ8AwdnR80iShKIoaKpMLmXQ35tDVCoVRkZG+Ncf/BsLFVAEeMFJYiChg+NDHIMUQwzIgLTYY9pNlSEA4ggUBbwQCnmNHZ/6M6YnTyNGz5zjyOGjlCqQVCGRlpFlmYYVIMtgaDJRFCHHIIRAUxVkWSYOI8IwBNH2aL7kohogFIHsBFSrHkfeOszOHdsQq1at4uFHn6LLlIjjGKGqGIaBkZSIoghJUlBVFV2oKIpCHAUEQUAUhERRhNllYlkWEQ1AIEsKxWKK+YWL/Pq3h/jkXR9FXtbfT1JAQtOJfNCFSq1cQ5cUDFmgxjEiihBxhBwGyEG7E/gQ+MzOXMK2mmSTCRIqJLWY2G/S29VBTxe89rvXkCcnJ1EUSKfT9PV1k8/nWbFiGR/e9TGefuUAn3zwc6TSCaLIJ44DRELHyKTQDI1kOsny5VewZs0wsizjOA6apmHbNs1mE13XARCKCAlCSKYEkiRRKS3Q3d3NB+/4OPnOArvuvg+Z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",
    },
    preferences: {
      fb_popup: true,
      critical_hits: true,
      fb_hits: true,
      fb_info: true,
      ids_popup: true,
      fbanalyzerHtml5: true,
      owned_forts: true,
      lang: null,
    },
    prepareInjection: function (string, pos, length, inject) {
      var str = string;
      for (var i = 0; i < pos.length; i++) {
        var index = str.indexOf(pos[i]);
        str = str.substr(0, index) + inject[i] + str.substr(index + length[i]);
      }
      return str;
    },
    init: function () {
      if (localStorage.getItem("TWBattleToolkit_preferences")) {
        var storage = JSON.parse(localStorage.getItem("TWBattleToolkit_preferences"));
        for (var key in TWBattleToolkit.preferences) {
          if (storage[key] === undefined) {
            storage[key] = TWBattleToolkit.preferences[key];
          }
        }
        TWBattleToolkit.preferences = storage;
      }
      TWBattleToolkit.preferences.lang =
        TWBattleToolkit.preferences.lang == null
          ? TWBattleToolkit.langs[Game.locale]
            ? Game.locale
            : "en_US"
          : TWBattleToolkit.preferences.lang;

      $.getJSON(
        TWBattleToolkit.langs.base_url +
        TWBattleToolkit.langs[TWBattleToolkit.preferences.lang] +
        "?" +
        TWBattleToolkit.version * 100,
        function (translation) {
          TWBattleToolkit.lang = translation;
          $.get(TWBattleToolkit.updateURL, function (last_version) {
            if (parseFloat(last_version) > TWBattleToolkit.version) {
              var updatedialog = new west.gui.Dialog(
                "TWBattleToolkit",
                TWBattleToolkit.lang.updateAvailable + " (v" + last_version + ")",
                west.gui.Dialog.SYS_WARNING
              )
                .addButton(TWBattleToolkit.lang.updateDownload, function () {
                  updatedialog.hide();
                  location.href = TWBattleToolkit.website + "/twtoolkit.user.js";
                })
                .addButton("cancel")
                .show();
            }

            TWBattleToolkit.api = TheWestApi.register(
              "TW-Battle-Toolkit",
              TWBattleToolkit.scriptName,
              TWBattleToolkit.gameMIN,
              TWBattleToolkit.gameMAX,
              TWBattleToolkit.author,
              TWBattleToolkit.website
            );
            TWBattleToolkit.api.setGui(TWBattleToolkit.lang.api_gui);
            TWBattleToolkit.createButton();


            if (TWBattleToolkit.preferences.ids_popup === true)
              TWBattleToolkit.enhancedItemPopup.init();

            if (TWBattleToolkit.preferences.fb_info === true)
              TWBattleToolkit.FortBattleInfo.initFbInfo();

            if (TWBattleToolkit.preferences.fb_hits === true)
              TWBattleToolkit.FortBattleInfo.initFbHits();

            if (
              TWBattleToolkit.preferences.fb_info === true ||
              TWBattleToolkit.preferences.fb_hits === true
            )
              TWBattleToolkit.FortBattleInfo.init();

            if (TWBattleToolkit.preferences.fb_popup === true)
              TWBattleToolkit.fbPopup.init();

            if (TWBattleToolkit.preferences.critical_hits === true)
              TWBattleToolkit.critHits.init();

            if (TWBattleToolkit.preferences.owned_forts === true)
              TWBattleToolkit.owned_forts.init();

            if (TWBattleToolkit.preferences.fbanalyzerHtml5 === true)
              TWBattleToolkit.fbanalyzerHtml5.init();
          }).error(function () {
            TWBattleToolkit.err();
          });
        }
      ).error(function () {
        TWBattleToolkit.err();
      });
    },
    createButton: function () {
      var icon = $("<div></div>")
        .attr({
          class: "menulink",
          title: "The-West Toolkit",
        })
        .css({
          background: "url(" + TWBattleToolkit.icons.button + ")",
          "background-position": "0px 0px",
        })
        .mouseleave(function () {
          $(this).css("background-position", "0px 0px");
        })
        .mouseenter(function (e) {
          $(this).css("background-position", "25px 0px");
        })
        .click(function () {
          TWBattleToolkit.ui.openWindow();
        });
      var bottom = $("<div></div>").attr({
        class: "menucontainer_bottom",
      });
      $("#ui_menubar .ui_menucontainer:last").after(
        $("<div></div>")
          .attr({
            class: "ui_menucontainer",
            id: "TWBattleToolkit",
          })
          .append(icon)
          .append(bottom)
      );
    },
    savePreferences: function () {
      localStorage.setItem(
        "TWBattleToolkit_preferences",
        JSON.stringify(TWBattleToolkit.preferences)
      );
    },
    err: function () {
      WestUi.NotiBar.add(
        new OnGoingPermanentEntry(
          function () {
            location.href = TWBattleToolkit.website + "/code.user.js";
          },
          "<strong>TW Toolkit Error</strong><br/><i>Oops, unreachable url</i><br/>Feel free to contact me at thathanka.tw@gmail.com",
          "hint"
        )
      );
    },
    ui: {
      showTab: function (win, id) {
        if (!win) return;
        win
          .activateTab(id)
          .$("div.tw2gui_window_content_pane > *", win.divMain)
          .each(function (i, e) {
            if ($(e).hasClass(win.id + "-" + id)) {
              $(e).children().fadeIn();
              $(e).show();
            } else {
              $(e).children().fadeOut();
              $(e).hide();
            }
          });
      },
      tabclick: function (win, id) {
        TWBattleToolkit.ui.showTab(win, id);
      },
      openWindow: function () {
        //Preferences tab
        var pref_content = $('<div style="padding:10px;"></div>');
        var checkboxes = [
          "fb_popup",
          "critical_hits",
          "fb_hits",
          "fb_info",
          "ids_popup",
          "fbanalyzerHtml5",
          "owned_forts",
        ];
        pref_content
          .append(
            new west.gui.Button(TWBattleToolkit.lang.pref_apply)
              .click(function () {
                location.reload();
              })
              .getMainDiv()
          )
          .append("<br/><br/>");
        for (i = 0; i < checkboxes.length; i++) {
          pref_content
            .append(
              new west.gui.Checkbox(
                TWBattleToolkit.lang.prefs[checkboxes[i]],
                checkboxes[i]
              )
                .setId(checkboxes[i])
                .setSelected(TWBattleToolkit.preferences[checkboxes[i]])
                .setCallback(function (val) {
                  TWBattleToolkit.preferences[this.groupClass] = val;
                  TWBattleToolkit.savePreferences();
                })
                .getMainDiv()
                .css("margin", "2px")
            )
            .append("<br/>");
        }
        pref_content.append(TWBattleToolkit.lang.script_lang).append(
          new west.gui.Combobox()
            .addItem("en_US", "English")
            .addItem("fr_FR", "Français")
            .addItem("de_DE", "Deutsch")
            .addItem("pt_PT", "Português")
            .addItem("pl_PL", "Polski")
            .addItem("it_IT", "Italiano")
            .addItem("es_ES", "Español")
            .addItem("hu_HU", "Magyar")
            .addItem("ru_RU", "русский")
            .addItem("cs_CZ", "čeština")
            .addItem("bg_BG", "български")
            .addItem("el_GR", "Ελληνικά")
            .addItem("sv_SE", "Svenska")
            .addItem("sk_SK", "Slovenčina")
            .addItem("tr_TR", "Türkçe")
            .select(TWBattleToolkit.preferences.lang)
            .addListener(function (val) {
              TWBattleToolkit.preferences.lang = val;
              TWBattleToolkit.savePreferences();
            })
            .getMainDiv()
        );
        var pref_tab = $(
          new west.gui.Scrollpane()
            .appendContent(pref_content)
            .addClass("west-toolkit-preferences")
            .getMainDiv()
        ).css("margin-top", "6px");
        TWBattleToolkit.ui.window = wman
          .open("west-toolkit", null, "west-toolkit")
          .setTitle("The West Toolkit")
          .setMiniTitle("TWBattleToolkit")
          .addTab(TWBattleToolkit.lang.pref, "preferences", TWBattleToolkit.ui.tabclick)
          .appendToContentPane(pref_tab);
        TWBattleToolkit.ui.showTab(TWBattleToolkit.ui.window, "preferences");
      },
    },
    fbPopup: {
      getPosition: function (fortx, forty, x, y) {
        var diffx = fortx - x;
        var diffy = forty - y;
        if (diffx === 0 && diffy === 0) {
          return '<img src ="/images/town/cityhall/green.png" />';
        } else if (Math.abs(diffx) <= 500 && Math.abs(diffy) <= 500) {
          return '<img src ="/images/town/cityhall/yellow.png" />';
        } else {
          return '<img src ="/images/town/cityhall/red.png" />';
        }
      },
      getCharClassImg: function (classId) {
        var charclasses = {
          "-1": "greenhorn",
          0: "adventurer",
          1: "duelist",
          2: "worker",
          3: "soldier",
        };
        return (
          "/images/class_choose/symbol_" + charclasses[classId] + "_small.png"
        );
      },
      getGradeImg: function (gradeId, title, cls) {
        return (
          '<img class="' +
          (cls || "") +
          '" src="/images/chat/servicegrade_' +
          TWBattleToolkit.fbPopup.gradeNames[gradeId] +
          '.png" title="' +
          (title ? TWBattleToolkit.fbPopup.gradeNames[gradeId].escapeHTML() : "") +
          '" />'
        );
      },
      getPrivLink: function (player, grade, text, preBattle) {
        return $(
          '<a style="display: block" href="javascript: void(0);">' +
          TWBattleToolkit.fbPopup.getGradeImg(grade) +
          " " +
          text +
          "</a>"
        ).click(function () {
          preBattle.battleData.privList[player.player_id] = grade;
          preBattle.savePrivileges();
          FortBattleWindow.mb.hide();
        });
      },
      getPrivileges: function (player, pp, ownPriv, preBattle) {
        var grades = $("<div/>");
        var gv = {
          TRAITOR: "-2",
          RESERVIST: "-1",
          RECRUIT: "0",
          PRIVATE: "1",
          SERGEANT: "2",
          CAPTAIN: "3",
          GENERAL: "4",
        };
        if (pp < ownPriv) {
          if (pp != gv.CAPTAIN && ownPriv > gv.CAPTAIN)
            grades.append(
              TWBattleToolkit.fbPopup.getPrivLink(
                player,
                gv.CAPTAIN,
                TWBattleToolkit.lang.fbpopup_appoint_captain,
                preBattle
              )
            );
          if (pp != gv.SERGEANT)
            grades.append(
              TWBattleToolkit.fbPopup.getPrivLink(
                player,
                gv.SERGEANT,
                TWBattleToolkit.lang.fbpopup_appoint_sergeant
              )
            );
          if (pp != gv.PRIVATE)
            grades.append(
              TWBattleToolkit.fbPopup.getPrivLink(
                player,
                gv.PRIVATE,
                TWBattleToolkit.lang.fbpopup_appoint_private,
                preBattle
              )
            );
          if (pp != gv.RECRUIT)
            grades.append(
              TWBattleToolkit.fbPopup.getPrivLink(
                player,
                gv.RECRUIT,
                TWBattleToolkit.lang.fbpopup_appoint_recruit,
                preBattle
              )
            );
          if (pp != gv.RESERVIST)
            grades.append(
              TWBattleToolkit.fbPopup.getPrivLink(
                player,
                gv.RESERVIST,
                TWBattleToolkit.lang.fbpopup_appoint_reservist,
                preBattle
              )
            );
          if (pp != gv.TRAITOR)
            grades.append(
              TWBattleToolkit.fbPopup.getPrivLink(
                player,
                gv.TRAITOR,
                TWBattleToolkit.lang.fbpopup_appoint_traitor,
                preBattle
              )
            );
        } else {
          grades.append(TWBattleToolkit.lang.fbpopup_error_rank);
          if (Character.playerId == player.player_id) {
            grades.append("<br />" + TWBattleToolkit.lang.fbpopup_error_self);
          }
        }
        FortBattleWindow.mb = new west.gui.Dialog(player.name, grades)
          .addButton("cancel")
          .show();
      },
      gradeNames: {
        "-2": "traitor",
        "-1": "reservist",
        0: "recruit",
        1: "private",
        2: "sergeant",
        3: "captain",
        4: "general",
      },
      init: function () {
        FortBattleWindow.showCellPopup = (function (x, y, cellIdx) {
          var popup = new MousePopup("");
          return function (x, y, cellIdx) {
            var i, id;
            var charsatcursor = [];
            var charlist = this.preBattle.battleData.playerlist,
              map = this.preBattle.mapData;
            for (i = 0; i < charlist.length; i++) {
              if (!charlist.hasOwnProperty(i)) continue;
              var curIdx = charlist[i].idx;
              if (charlist[i].player_id == Character.playerId) {
                curIdx = this.preBattle.battleData.selfIdx;
                TWBattleToolkit.fbPopup.ownGrade = charlist[i].privilege;
              }
              FortBattleWindow.pre = this.preBattle;
              if (curIdx == cellIdx) {
                charsatcursor.push(charlist[i]);
              }
            }
            var sector = map.sectors[map.cells[cellIdx]];
            if (popup.idx != cellIdx) {
              popup.text =
                "<table cellpadding=0 cellspacing=0><tr>" +
                "<td><img src='/images/fort/battle/attacker_primary.png' /></td><td>&nbsp;" +
                (sector.attackerBonus || 0) +
                "&nbsp;</td>" +
                "<td><img src='/images/fort/battle/defender_primary.png' /></td><td>&nbsp;" +
                (sector.defenderBonus || 0) +
                "&nbsp;</td>" +
                "<td><img src='/images/fort/battle/height_symbol.png' /></td><td>&nbsp;" +
                (sector.height || 0) +
                "&nbsp;</td>" +
                (sector.classBonus
                  ? "<td><img src='" +
                  TWBattleToolkit.fbPopup.getCharClassImg(sector.classType) +
                  "' /></td><td>&nbsp;" +
                  sector.classBonus +
                  "&nbsp;"
                  : "") +
                "</tr></table>";
              popup.idx = cellIdx;
            } else {
              popup.updatePosition(
                {
                  clientX: x,
                  clientY: y,
                },
                true
              );
              return popup;
            }
            if (charsatcursor.length === 0) {
              popup.updatePosition(
                {
                  clientX: x,
                  clientY: y,
                },
                true
              );
              return popup;
            }
            popup.text +=
              TWBattleToolkit.lang.fbpopup_player +
              "<table style='margin:0;padding:0;font-size:8pt'>";
            for (i = 0; i < charsatcursor.length; i++) {
              id = charsatcursor[i].player_id;
              popup.text +=
                "<tr  style='font-size:8pt;height:20px;" +
                (id == Character.playerId ? "font-weight:bold;" : "") +
                "'><td>" +
                (i + 1) +
                ".</td><td>" +
                charsatcursor[i].name +
                "&nbsp;</td><td>" +
                charsatcursor[i].level +
                "&nbsp;<img src='/images/class_choose/symbol_" +
                charsatcursor[i]["class"] +
                "_small_chat.png'/>&nbsp;" +
                TWBattleToolkit.fbPopup.getGradeImg(charsatcursor[i].privilege) +
                "</td>";
              if (charsatcursor[i].currhealth !== undefined) {
                popup.text +=
                  "&nbsp<td><div class='fortbattle' style='vertical-align:top;'><div class='recruit_health_container' style='margin:0px'><div class='recruit_healthbar' style='width:" +
                  (charsatcursor[i].currhealth / charsatcursor[i].maxhealth) *
                  84 +
                  "px;margin:0px'><div class='recruit_health'>" +
                  charsatcursor[i].currhealth +
                  " / " +
                  charsatcursor[i].maxhealth +
                  "</div></div></div></td><td>&nbsp" +
                  TWBattleToolkit.fbPopup.getPosition(
                    this.preBattle.battleData.fortCoords.x,
                    this.preBattle.battleData.fortCoords.y,
                    charsatcursor[i].coords.x,
                    charsatcursor[i].coords.y
                  ) +
                  "</td></tr>";
                document.onkeyup = function (e) {
                  if (popup.active === true) {
                    if (e.keyCode >= 49 && e.keyCode <= 57) {
                      id = e.keyCode - 49;
                      if (charsatcursor[id]) {
                        TWBattleToolkit.fbPopup.getPrivileges(
                          charsatcursor[id],
                          FortBattleWindow.pre.getPrivilege(charsatcursor[id]),
                          TWBattleToolkit.fbPopup.ownGrade,
                          FortBattleWindow.pre
                        );
                      }
                    } else if (e.keyCode >= 97 && e.keyCode <= 105) {
                      id = e.keyCode - 97;
                      if (charsatcursor[id]) {
                        TWBattleToolkit.fbPopup.getPrivileges(
                          charsatcursor[id],
                          FortBattleWindow.pre.getPrivilege(charsatcursor[id]),
                          TWBattleToolkit.fbPopup.ownGrade,
                          FortBattleWindow.pre
                        );
                      }
                    }
                  }
                };
              } else {
                popup.text += "</tr>";
              }
            }
            popup.text += "</table>";
            popup.updatePosition(
              {
                clientX: x,
                clientY: y,
              },
              true
            );
            return popup;
          };
        })();
      },
    },
    critHits: {
      init: function () {
        document.styleSheets[0].insertRule(
          '.cemetery .fancytable  .row_head .battle_cri span {background: url("' +
          TWBattleToolkit.icons.crithits +
          '");height: 17px;width: 16px;}'
        );
        document.styleSheets[0].insertRule(
          ".cemetery .fancytable .battle_cri, .cemetery .fancytable .battle_gho {width: 18px;}"
        );
        document.styleSheets[0].insertRule(
          '.cemetery .fancytable  .row_head .battle_gho span {background: url("' +
          TWBattleToolkit.icons.playdeadcount +
          '");height: 17px;width: 16px;}'
        );
        document.styleSheets[0].insertRule(
          ".cemetery #battle_stat.fancytable div.battle_tow {width: 60px !important;}"
        );
        var inject1 = TWBattleToolkit.prepareInjection(
          CemeteryWindow.showStatInit.toString(),
          ["$('div.cemetery-content',"],
          [0],
          [
            "CemeteryWindow.table.addColumn('battle_cri',{sortBy:'crithits'}).addColumn('battle_gho',{sortBy:'playdeadcount'}).appendToThCell('head','battle_cri',TWBattleToolkit.lang.fbcemetery_head_cri,'&nbsp;').appendToThCell('head','battle_gho',TWBattleToolkit.lang.fbcemetery_head_gho,'&nbsp;');sortByObj.sortBy=null;",
          ]
        );
        var inject2 = TWBattleToolkit.prepareInjection(
          CemeteryWindow.showStatUpdateTable.toString(),
          [
            "CemeteryWindow.table.buildRow('battlestat tw_red'",
            "CemeteryWindow.table.buildRow('battlestat tw_blue'",
          ],
          [0, 0],
          [
            "tmpCells['battle_cri']=rd.charclass==1?rd.crithits:'-';tmpCells['battle_gho']=rd.charclass==0?rd.playdeadcount:'-';",
            "tmpCells['battle_cri']=rd.charclass==1?rd.crithits:'-';tmpCells['battle_gho']=rd.charclass==0?rd.playdeadcount:'-';",
          ]
        );
        var inject3 =
          "var sortByObj={sortBy:null,orderBy:'ASC'};" +
          "var startSortDispatcher=function(ev){var sortBy='';sortBy=$(ev.target).closest('div.cell').data('sortBy');if(sortByObj.sortBy==sortBy){sortByObj.orderBy=sortByObj.orderBy=='asc'?'desc':'asc';CemeteryWindow.currentStats.reverse();}else{sortByObj.sortBy=sortBy;sortByObj.orderBy='asc';switch(sortBy){case'name':case'townname':CemeteryWindow.currentStats.sort(sortStrings(sortBy));break;case'ko_shots':CemeteryWindow.currentStats.sort(sortLength(sortBy));break;default:if($.isNumeric(CemeteryWindow.currentStats[0][sortBy])) CemeteryWindow.currentStats.sort(sortNumbers(sortBy));break;}}updatePlayerStatTable(CemeteryWindow.currentStats);};" +
          "var sortLength=function(col) {return function(a,b) {return b[col].length-a[col].length;};};" +
          "var sortNumbers=function(col) {return function(a,b) {return b[col]-a[col];};};" +
          "var sortStrings=function(col) {return function(a,b) {return a[col].toUpperCase().replace(/[À-Ä]/g,'A').replace(/[Ò-Ö]/,'O').replace(/[Ù-Ü]/,'U').replace(/[È-Ë]/,'E')>b[col].toUpperCase().replace(/[À-Ä]/g,'A').replace(/[Ò-Ö]/,'O').replace(/[Ù-Ü]/,'U').replace(/[È-Ë]/,'E')?1:-1;};};" +
          "var updatePlayerStatTable=function() {CemeteryWindow.table.clearBody();var tmpCells={};for(var i=0;i<CemeteryWindow.currentStats.length;i++) {var rd=CemeteryWindow.currentStats[i];tmpCells['battle_nam']=rd.name;tmpCells['battle_tow']=rd.townname;tmpCells['battle_shp']=rd.starthp;tmpCells['battle_ehp']=rd.finishedhp;tmpCells['battle_fla']=rd.flagholdcount;tmpCells['battle_hco']=rd.hitcount;tmpCells['battle_fco']=rd.misscount;tmpCells['battle_dco']=rd.totalcauseddamage;tmpCells['battle_ohi']=rd.takenhits;tmpCells['battle_ofa']=rd.dodgecount;tmpCells['battle_odm']=rd.takendamage;tmpCells['battle_avd']=rd.avg_damage;tmpCells['battle_okh']=rd.ko_shots.length;tmpCells['battle_onl']=rd.onlinecount;tmpCells['battle_cri']=rd.charclass==1?rd.crithits:'-';tmpCells['battle_gho']=rd.charclass==0?rd.playdeadcount:'-';CemeteryWindow.table.buildRow('battlestat '+(rd.battle_type=='defender'?'tw_blue':'tw_red'),tmpCells,addKoShotTitle(rd.ko_shots));}};" +
          "var addKoShotTitle=function(koShots){return function(row){if(koShots.length){$('.battle_okh',row).attr('title',koShots.join(', '));} return row;}};";
        eval(
          "(function($){CemeteryWindow.showStatInit = " +
          inject1 +
          ";CemeteryWindow.showStatUpdateTable = " +
          inject2 +
          ";" +
          inject3 +
          "})(jQuery);"
        );
      },
    },
    enhancedItemPopup: {
      init: function () {
        $.getJSON(TWBattleToolkit.setsURL, function (sets) {
          ItemPopup.getXHTMLOrigin = ItemPopup.getXHTML;
          ItemPopup.getXHTML = function () {
            var popup = ItemPopup.getXHTMLOrigin.call(this);
            if (sets[this.item_obj.set]) {
              var event = sets[this.item_obj.set];
              popup +=
                "<br/><p style='text-align:center;font-size: 10pt;'><img src='" +
                TWBattleToolkit.icons[event[0]] +
                "'/> " +
                event[1] +
                "</p>";
            } else {
              popup += "<br/>";
            }
            popup +=
              "<p style='color:blue;text-align:center;font-size: 9pt;'>[item=<strong>" +
              this.item_obj.item_id +
              "</strong>]</p>";
            return popup;
          };
        }).error(function () {
          TWBattleToolkit.err();
        });
      },
    },
    FortBattleInfo: {
      stats: {},
      initFbInfo: function () {
        FortBattle.flashShowCharacterInfoOrigin =
          FortBattle.flashShowCharacterInfo;
        FortBattle.flashShowCharacterInfo = function (...args) {
          FortBattle.flashShowCharacterInfoOrigin(...args);
          $(
            "div.recruitlist_name",
            "#fort_battle_" + args[0] + "_infoarea"
          ).html(
            '<span onclick="PlayerProfileWindow.open(' +
            args[1] +
            ');" style="cursor:pointer;">' +
            $("div.recruitlist_name").text() +
            "</span>"
          );
        };
        FortBattle.getCharDataSheetOrigin = FortBattle.getCharDataSheet;
        FortBattle.getCharDataSheet = function (data) {
          return (
            FortBattle.getCharDataSheetOrigin(data) +
            '<div><img src="' +
            TWBattleToolkit.icons.totaldmg +
            '" title="' +
            TWBattleToolkit.lang.fbinfo_totaldmg +
            '" /> %totalDmg%</div>'
          );
        };
      },
      initFbHits: function () {
        FortBattle.addRoundStatusMessageOrigin =
          FortBattle.addRoundStatusMessage;
        FortBattle.addRoundStatusMessage = function (fortId, queue) {
          FortBattle.addRoundStatusMessageOrigin(fortId, queue);
          if (!TWBattleToolkit.FortBattleInfo.stats[fortId]) {
            TWBattleToolkit.FortBattleInfo.stats[fortId] = {
              hit: 0,
              missed: 0,
              gotshot: 0,
              dodge: 0,
            };
          }
          for (var i = 0; i < queue.length; i++) {
            var msg = queue[i];
            switch (msg.action) {
              case "gotshot":
                if (msg.damage === 0) {
                  TWBattleToolkit.FortBattleInfo.stats[fortId].dodge++;
                } else {
                  TWBattleToolkit.FortBattleInfo.stats[fortId].gotshot++;
                }
                break;
              case "shot":
                if (msg.damage === 0) {
                  TWBattleToolkit.FortBattleInfo.stats[fortId].missed++;
                } else {
                  TWBattleToolkit.FortBattleInfo.stats[fortId].hit++;
                }
                break;
            }
          }
          if (queue.length !== 0) {
            FortBattle.showMessage(
              fortId,
              "<strong>" +
              TWBattleToolkit.lang.fbinfo_total +
              " | " +
              TWBattleToolkit.lang.fbinfo_hit +
              " : </strong>" +
              TWBattleToolkit.FortBattleInfo.stats[fortId].hit +
              "<strong> | " +
              TWBattleToolkit.lang.fbinfo_missed +
              " : </strong>" +
              TWBattleToolkit.FortBattleInfo.stats[fortId].missed +
              "<strong> | " +
              TWBattleToolkit.lang.fbinfo_gotshot +
              " : </strong>" +
              TWBattleToolkit.FortBattleInfo.stats[fortId].gotshot +
              "<strong> | " +
              TWBattleToolkit.lang.fbinfo_dodge +
              " : </strong>" +
              TWBattleToolkit.FortBattleInfo.stats[fortId].dodge
            );
          }
        };
      },
      init: function () {
        FortBattle.addFinishMessageOrigin = FortBattle.addFinishMessage;
        FortBattle.addFinishMessage = function (fortId, msg) {
          FortBattle.addFinishMessageOrigin(fortId, msg);
          TWBattleToolkit.FortBattleInfo.stats[fortId] = {
            hit: 0,
            missed: 0,
            gotshot: 0,
            dodge: 0,
          };
        };
      },
    },
    fbanalyzerHtml5: {
      fbs: {},
      open: function (fortId) {
        var tab_stats = $(
          '<div class="west-toolkit-analyzer-stats" id="stats" style="height:335px;margin-top:-10px;"></div>'
        );
        var tab_graph = $(
          '<div class="west-toolkit-analyzer-graph" style="height:325px;"><canvas id="graph"></canvas></div>'
        );
        var tab_search = $(
          '<div class="west-toolkit-analyzer-search" style="padding-top:20px;width:350px;margin:auto;"></div>'
        );
        tab_search.append(
          new west.gui.Textfield("analyzer-search")
            .setPlaceholder(TWBattleToolkit.lang.search)
            .getMainDiv()
            .on("change paste keyup", function () {
              var input = $(this).find("input").val();
              var results = TWBattleToolkit.fbanalyzerHtml5.searchPlayers(
                fortId,
                input
              );
              TWBattleToolkit.fbanalyzerHtml5.showSearchResults(fortId, results);
            })
        );
        var search_results = new west.gui.Table()
          .setId("search_results")
          .createEmptyMessage(TWBattleToolkit.lang.no_results);
        tab_search.append(search_results.getMainDiv());
        search_results.$("div.no-content").show();
        TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].search_results = search_results;
        TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].graph = {};
        TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].graph.config = {
          type: "bar",
          data: {
            labels: [],
            datasets: [
              {
                type: "line",
                yAxisID: "hp",
                label:
                  TWBattleToolkit.lang.attackers +
                  " - " +
                  CharacterSkills.skills.health.name,
                backgroundColor: "#c00",
                borderColor: "#c00",
                data: [],
                fill: false,
              },
              {
                type: "line",
                yAxisID: "hp",
                label:
                  TWBattleToolkit.lang.defenders +
                  " - " +
                  CharacterSkills.skills.health.name,
                fill: false,
                backgroundColor: "#07d",
                borderColor: "#07d",
                data: [],
              },
              {
                type: "bar",
                yAxisID: "dmg",
                label:
                  TWBattleToolkit.lang.attackers +
                  " - " +
                  TWBattleToolkit.lang.fbinfo_totaldmg,
                backgroundColor: "rgba(204,0,0,0.2)",
                hoverBackgroundColor: "rgba(204,0,0,0.3)",
                borderColor: "#c00",
                borderWidth: 1,
                data: [],
              },
              {
                type: "bar",
                yAxisID: "dmg",
                label:
                  TWBattleToolkit.lang.defenders +
                  " - " +
                  TWBattleToolkit.lang.fbinfo_totaldmg,
                backgroundColor: "rgba(0,119,221,0.2)",
                hoverBackgroundColor: "rgba(0,119,221,0.3)",
                borderColor: "#07d",
                borderWidth: 1,
                data: [],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            tooltips: {
              mode: "index",
            },
            legend: {
              position: "bottom",
            },
            responsive: true,
            scales: {
              xAxes: [
                {
                  maxBarThickness: 20,
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: TWBattleToolkit.lang.round,
                  },
                },
              ],
              yAxes: [
                {
                  id: "hp",
                  position: "left",
                  ticks: {
                    beginAtZero: true,
                  },
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: CharacterSkills.skills.health.name,
                  },
                },
                {
                  id: "dmg",
                  position: "right",
                  display: true,
                  gridLines: {
                    display: false,
                  },
                  ticks: {
                    beginAtZero: true,
                  },
                  scaleLabel: {
                    display: true,
                    labelString: TWBattleToolkit.lang.fbinfo_totaldmg,
                  },
                },
              ],
            },
          },
        };
        TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].window = wman
          .open(
            "west-toolkit-analyzer",
            null,
            "west-toolkit-analyzer ally-window noreload nocloseall nominimize dontminimize"
          )
          .setMiniTitle("TWBattleToolkit")
          .addTab(TWBattleToolkit.lang.stats, "stats", TWBattleToolkit.ui.tabclick)
          .addTab(TWBattleToolkit.lang.search, "search", TWBattleToolkit.ui.tabclick)
          .addTab(TWBattleToolkit.lang.graph, "graph", TWBattleToolkit.ui.tabclick)
          .appendToContentPane(tab_stats, tab_search, tab_graph)
          .setSize(600, 410);
        var ctx = $(TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].window.divMain)
          .find("canvas#graph")
          .get(0)
          .getContext("2d");
        TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].graph.chart = new Chart(
          ctx,
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].graph.config
        );
        TWBattleToolkit.ui.showTab(
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].window,
          "stats"
        );
        TWBattleToolkit.fbanalyzerHtml5.handlePlayerInfo(fortId);
        TWBattleToolkit.fbanalyzerHtml5.updateStats(fortId);
        TWBattleToolkit.fbanalyzerHtml5.updateGraph(fortId);
      },
      addButton: function (fortId, windowDiv) {
        $(windowDiv)
          .find(".tw2gui_window_content_pane")
          .append(
            '<div class="fort_battle_button_analyzer" onclick="TWBattleToolkit.fbanalyzerHtml5.open(' +
            fortId +
            ')" title="' +
            TWBattleToolkit.lang.openanalyzer +
            '" style="cursor: pointer; position: absolute; background-image: url(' +
            TWBattleToolkit.icons.analyzer_button +
            '); width: 25px; height: 25px;top: 10px;left: 475px;"></div>'
          );
      },
      dameraulevenshtein_dist: function (s1, s2) {
        function initMatrix(s1, s2) {
          if (undefined == s1 || undefined == s2) {
            return null;
          }
          let d = [];
          for (let i = 0; i <= s1.length; i++) {
            d[i] = [];
            d[i][0] = i;
          }
          for (let j = 0; j <= s2.length; j++) {
            d[0][j] = j;
          }
          return d;
        }

        function damerau(i, j, s1, s2, d, cost) {
          if (
            i > 1 &&
            j > 1 &&
            s1[i - 1] === s2[j - 2] &&
            s1[i - 2] === s2[j - 1]
          ) {
            d[i][j] = Math.min.apply(null, [d[i][j], d[i - 2][j - 2] + cost]);
          }
        }
        if (
          undefined == s1 ||
          undefined == s2 ||
          "string" !== typeof s1 ||
          "string" !== typeof s2
        ) {
          return -1;
        }
        let d = initMatrix(s1, s2);
        if (null === d) {
          return -1;
        }
        for (var i = 1; i <= s1.length; i++) {
          let cost;
          for (let j = 1; j <= s2.length; j++) {
            if (s1.charAt(i - 1) === s2.charAt(j - 1)) {
              cost = 0;
            } else {
              cost = 1;
            }
            d[i][j] = Math.min.apply(null, [
              d[i - 1][j] + 1,
              d[i][j - 1] + 1,
              d[i - 1][j - 1] + cost,
            ]);
            damerau(i, j, s1, s2, d, cost);
          }
        }
        return d[s1.length][s2.length];
      },
      searchPlayers: function (fortId, input) {
        var players = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.players;
        var search = input.toLowerCase();
        if (search === "") {
          return [];
        } else {
          var match = [];
          for (var charId in players) {
            var dist = TWBattleToolkit.fbanalyzerHtml5.dameraulevenshtein_dist(
              search,
              players[charId].name.toLowerCase()
            );
            if (
              dist <=
              Math.abs(players[charId].name.length - search.length) +
              Math.min(players[charId].name.length, search.length) / 2
            ) {
              match.push({
                charId: charId,
                dist: dist,
              });
            }
          }
          match = match.sort(function (a, b) {
            return a.dist - b.dist;
          });
          if (match.length > 0 && match[0].dist === 0) {
            return [match[0]];
          } else {
            return match;
          }
        }
      },
      showSearchResults: function (fortId, players) {
        var search_results =
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].search_results;
        search_results.clearBody();
        if (players.length > 0) {
          search_results.$("div.no-content").hide();
          for (var i = 0; i < players.length; i++) {
            search_results.appendRow();
            search_results.appendToCell(
              i,
              "player",
              TWBattleToolkit.fbanalyzerHtml5.getPlayerHTML(fortId, players[i].charId)
            );
          }
        } else {
          search_results.$("div.no-content").show();
        }
      },
      updateStats: function (fortId) {
        if (
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data &&
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].window
        ) {
          var container = $(
            TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].window.divMain
          ).find("#stats");
          var data = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data;

          function getEvol(team, prop) {
            if (!data[team]["prev" + prop]) {
              data[team]["prev" + prop] = data[team][prop];
            }
            return (
              '<small><span style="color:grey;margin-right: 5px;margin-left:5px;">(' +
              format_number(data[team][prop] - data[team]["prev" + prop]) +
              ")</span></small>"
            );
          }

          function getVal(team, prop) {
            var color = {
              attack: "#c00",
              defense: "#07d",
            }[team];
            return (
              '<span style="color:' +
              color +
              ';font-weight:bold;">' +
              format_number(data[team][prop]) +
              "</span>"
            );
          }

          function getClasses(team) {
            var html = "";
            var classes =
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team].classes;
            for (var cl in classes) {
              html +=
                `<figure style="display:inline-block;cursor:pointer;margin-left:2px;margin-right:2px;" onmouseenter="TWBattleToolkit.fbanalyzerHtml5.showClass(` +
                fortId +
                `,'` +
                team +
                `','` +
                cl +
                `')" onmouseleave="TWBattleToolkit.fbanalyzerHtml5.hidePosition(` +
                fortId +
                ');">' +
                Chat.Formatter.getClassImage(cl) +
                "<figcaption>" +
                classes[cl] +
                "</figcaption></figure>";
            }
            return html;
          }
          var round_html =
            '<div class="round" style="text-align:center;"><strong>' +
            TWBattleToolkit.lang.round +
            " " +
            data.round +
            "</strong><br>";
          round_html +=
            getEvol("attack", "hp") +
            getVal("attack", "hp") +
            " - " +
            CharacterSkills.skills.health.name +
            " - " +
            getVal("defense", "hp") +
            getEvol("defense", "hp");
          round_html += "<br>";
          round_html +=
            getEvol("attack", "nb") +
            getVal("attack", "nb") +
            " - " +
            TWBattleToolkit.lang.nbplayers +
            " - " +
            getVal("defense", "nb") +
            getEvol("defense", "nb");
          round_html += "<br>";
          round_html +=
            '<div style="vertical-align:middle;">' +
            getClasses("attack") +
            " - " +
            getClasses("defense") +
            "</div>";
          container.html(round_html);
          var table = new west.gui.Table();
          table
            .addColumn("hp-val")
            .addColumn("hp")
            .addColumn("losthp-val")
            .addColumn("losthp")
            .addColumn("dmg-val")
            .addColumn("dmg")
            .appendToCell("head", "hp", CharacterSkills.skills.health.name)
            .appendToCell("head", "losthp", TWBattleToolkit.lang.losthp)
            .appendToCell("head", "dmg", TWBattleToolkit.lang.fbinfo_lastdmg);

          function sortByKey(charIds, key) {
            var arr = charIds.slice(0);
            return arr.sort(function (a, b) {
              var x = data.players[a][key];
              var y = data.players[b][key];
              return x < y ? 1 : x > y ? -1 : 0;
            });
          }
          var hp = sortByKey(data.charIds, "health");
          var losthp = sortByKey(data.charIds, "damagetaken");
          var dmg = sortByKey(data.charIds, "shotdmg");
          for (var i = 0; i < hp.length; i++) {
            table.appendRow();
            table
              .appendToCell(
                i,
                "hp-val",
                format_number(data.players[hp[i]].health)
              )
              .appendToCell(
                i,
                "hp",
                TWBattleToolkit.fbanalyzerHtml5.getPlayerHTML(fortId, hp[i])
              )
              .appendToCell(
                i,
                "losthp-val",
                format_number(data.players[losthp[i]].damagetaken)
              )
              .appendToCell(
                i,
                "losthp",
                (data.players[losthp[i]].health <= 0
                  ? '<div class="mini_system_icon_error" title="KO"></div>'
                  : data.players[losthp[i]].damagetaken >
                    data.players[losthp[i]].health
                    ? '<div class="mini_system_icon_warning" title="' +
                    TWBattleToolkit.lang.hpwarning +
                    '"></div>'
                    : "") +
                TWBattleToolkit.fbanalyzerHtml5.getPlayerHTML(fortId, losthp[i])
              )
              .appendToCell(
                i,
                "dmg-val",
                data.players[dmg[i]].shotdmg === 65535
                  ? "KO"
                  : format_number(data.players[dmg[i]].shotdmg)
              )
              .appendToCell(
                i,
                "dmg",
                TWBattleToolkit.fbanalyzerHtml5.getPlayerHTML(fortId, dmg[i])
              );
          }
          container.html(
            new west.gui.Scrollpane()
              .appendContent(round_html)
              .appendContent(table.getMainDiv())
              .getMainDiv()
          );
        }
      },
      updateGraph: function (fortId) {
        if (
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data &&
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].window
        ) {
          var data = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data;
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].graph.config.data.labels.push(
            data.round
          );
          TWBattleToolkit.fbanalyzerHtml5.fbs[
            fortId
          ].graph.config.data.datasets[0].data.push(data.attack.hp);
          TWBattleToolkit.fbanalyzerHtml5.fbs[
            fortId
          ].graph.config.data.datasets[1].data.push(data.defense.hp);
          TWBattleToolkit.fbanalyzerHtml5.fbs[
            fortId
          ].graph.config.data.datasets[2].data.push(
            data.defense.prevhp - data.defense.hp
          );
          TWBattleToolkit.fbanalyzerHtml5.fbs[
            fortId
          ].graph.config.data.datasets[3].data.push(
            data.attack.prevhp - data.attack.hp
          );
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].graph.chart.update();
        }
      },
      getPlayerHTML: function (fortId, charId) {
        var player = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.players[charId];
        return (
          Chat.Formatter.getClassImage(player.class) +
          ' <span style="color:' +
          (player.team === "defense" ? "#07d" : "#c00") +
          ';font-weight:bold;cursor: pointer;" onmouseleave="TWBattleToolkit.fbanalyzerHtml5.hidePosition(' +
          fortId +
          ')" onmouseenter="TWBattleToolkit.fbanalyzerHtml5.showPosition(' +
          fortId +
          "," +
          charId +
          ');" onclick="PlayerProfileWindow.open(' +
          player.id +
          ');">' +
          player.name +
          "</span>"
        );
      },
      showPosition: function (fortId, charId) {
        var ctx = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].ctx;
        $(".char_icon.highlight", ctx.battlegroundEl).removeClass("highlight");
        ctx.highlightPlayer = ctx.charactersByCharId[charId];
        if (ctx.charIcons[ctx.highlightPlayer.characterid]) {
          ctx.charIcons[ctx.highlightPlayer.characterid].addClass("highlight");
        }
      },
      showClass: function (fortId, team, cl) {
        var ctx = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].ctx;
        $(".char_icon.highlight", ctx.battlegroundEl).removeClass("highlight");
        var players = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.players;
        for (var charId in players) {
          if (players[charId].class === cl && players[charId].team === team) {
            if (ctx.charIcons[charId]) {
              ctx.charIcons[charId].addClass("highlight");
            }
          }
        }
      },
      hidePosition: function (fortId) {
        var ctx = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].ctx;
        $(".char_icon.highlight", ctx.battlegroundEl).removeClass("highlight");
      },
      handlePlayerInfo: function (fortId) {
        var info = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].ctx;
        var charclasses = {
          "-1": "greenhorn",
          0: "adventurer",
          1: "duelist",
          2: "worker",
          3: "soldier",
        };
        if (!TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data) {
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data = {
            round: info.roundnumber,
            attack: {
              hp: 0,
              nb: 0,
              classes: {},
            },
            defense: {
              hp: 0,
              nb: 0,
              classes: {},
            },
            players: {},
            charIds: [],
          };
          if (info.characters) {
            for (var i = 0; i < info.characters.length; i++) {
              var player = {
                name: info.characters[i].name,
                id: info.characters[i].westPlayerId,
                position: info.characters[i].position,
                health: info.characters[i].health,
                healthmax: info.characters[i].healthmax,
                shotdmg: info.characters[i].shotdmg,
                causeddamage: info.characters[i].causeddamage,
                team: info.characters[i].team === 0 ? "defense" : "attack",
                class: charclasses[info.characters[i].characterclass],
                damagetaken: 0,
              };
              var char_id = info.characters[i].characterid;
              var team_name = player.team;
              if (player.health > 0) {
                TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].nb += 1;
                TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].hp +=
                  player.health;
                if (
                  !TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name]
                    .classes[player.class]
                ) {
                  TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].classes[
                    player.class
                  ] = 0;
                }
                TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].classes[
                  player.class
                ] += 1;
              }
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.players[char_id] =
                player;
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.charIds.push(char_id);
            }
          }
        }
      },
      handleRoundInfo: function (fortId, updatedChar, roundInfo) {
        if (
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId] &&
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data
        ) {
          var data = TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data;
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.round =
            roundInfo.roundnumber;
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.attack = {
            hp: 0,
            nb: 0,
            prevhp: data.attack.hp,
            prevnb: data.attack.nb,
            classes: {},
          };
          TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.defense = {
            hp: 0,
            nb: 0,
            prevhp: data.defense.hp,
            prevnb: data.defense.nb,
            classes: {},
          };
          for (var charId in updatedChar) {
            var player =
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data.players[charId];
            player.damagetaken = player.health - updatedChar[charId].health;
            player.shotdmg =
              updatedChar[charId].causeddamage - player.causeddamage;
            player.causeddamage = updatedChar[charId].causeddamage;
            player.position = updatedChar[charId].position;
            player.health = updatedChar[charId].health;
            var team_name = player.team;
            if (player.health > 0) {
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].nb += 1;
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].hp +=
                player.health;
              if (
                !TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].classes[
                player.class
                ]
              ) {
                TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].classes[
                  player.class
                ] = 0;
              }
              TWBattleToolkit.fbanalyzerHtml5.fbs[fortId].data[team_name].classes[
                player.class
              ] += 1;
            }
          }
          TWBattleToolkit.fbanalyzerHtml5.updateStats(fortId);
          TWBattleToolkit.fbanalyzerHtml5.updateGraph(fortId);
        }
      },
      init: function () {
        document.styleSheets[0].insertRule(
          ".west-toolkit-analyzer .hp, .dmg, .losthp {width: 25%;}"
        );
        document.styleSheets[0].insertRule(
          ".west-toolkit-analyzer .hp-val, .dmg-val, .losthp-val {width: 8%;text-align:center;}"
        );
        document.styleSheets[0].insertRule(
          "div.fort_battle_button_analyzer:hover {background-position-y:25px;}"
        );
        if (typeof Chart === "undefined") {
          $.getScript(TWBattleToolkit.chartURL);
        }
        FortBattleWindow.handleRoundInfoSignalOrigin =
          FortBattleWindow.handleRoundInfoSignal;
        FortBattleWindow.handleRoundInfoSignal = function (roundInfo) {
          FortBattleWindow.handleRoundInfoSignalOrigin.call(this, roundInfo);
          TWBattleToolkit.fbanalyzerHtml5.handleRoundInfo(
            this.fortId,
            this.charactersByCharId,
            roundInfo
          );
        };
        FortBattleWindow.handleConnectionOpenedOrigin =
          FortBattleWindow.handleConnectionOpened;
        FortBattleWindow.handleConnectionOpened = function () {
          FortBattleWindow.handleConnectionOpenedOrigin.call(this);
          if (!TWBattleToolkit.fbanalyzerHtml5.fbs[this.fortId]) {
            TWBattleToolkit.fbanalyzerHtml5.fbs[this.fortId] = {};
          }
          TWBattleToolkit.fbanalyzerHtml5.fbs[this.fortId].ctx = this;
          TWBattleToolkit.fbanalyzerHtml5.addButton(this.fortId, this.window.divMain);
        };
      },
    },
    owned_forts: {
      init: function () {
        $(document).on("click", ".tow_profileheader img", function () {
          var window = $(this).closest(".tw2gui_window");
          var town_id = parseInt(
            /CityhallWindow\.open\((.*)?\); return false;/g.exec(
              window.find(".imagemap_cityhall").attr("onclick")
            )[1]
          );
          var prop = {
            true: "owned",
            false: "members",
          }[
            this ===
            window
              .find('.tow_profileheader img[src*="fort_mini_icon"]')
              .get(0)
          ];
          if (
            TWBattleToolkit.owned_forts.data[town_id] &&
            TWBattleToolkit.owned_forts.data[town_id][prop].length !== 0
          ) {
            TWBattleToolkit.owned_forts.open(town_id, prop);
          }
        });
        document.styleSheets[0].insertRule(
          ".west-toolkit-forts-container .fortname {width: 75%;}"
        );
        document.styleSheets[0].insertRule(
          ".west-toolkit-forts-container .fortsize {width: 25%;text-align:center;}"
        );
        document.styleSheets[0].insertRule(
          '.tow_profileheader img[src*="fort_mini_icon"] {cursor:pointer;}'
        );
        Ajax.get("map", "get_minimap", {}, function (json) {
          for (var i in json.forts) {
            for (var j in json.forts[i]) {
              var fort = json.forts[i][j];
              if (fort.fort) {
                var owner = fort.fort.town_id;
                var members = fort.townIds ? fort.townIds : [];
                var fort_data = {
                  type: fort.fort.type,
                  id: fort.fort.fort_id,
                  x: fort.fort.x,
                  y: fort.fort.y,
                  name: fort.fort.name,
                };
                if (!TWBattleToolkit.owned_forts.data[owner]) {
                  TWBattleToolkit.owned_forts.data[owner] = {
                    owned: [],
                    members: [],
                  };
                }
                TWBattleToolkit.owned_forts.data[owner].owned.push(fort_data);
                for (var k = 0; k < members.length; k++) {
                  if (!TWBattleToolkit.owned_forts.data[members[k]]) {
                    TWBattleToolkit.owned_forts.data[members[k]] = {
                      owned: [],
                      members: [],
                    };
                  }
                  TWBattleToolkit.owned_forts.data[members[k]].members.push(
                    fort_data
                  );
                }
              }
            }
          }
        });
      },
      data: {},
      open: function (townId, type) {
        var forts_container = $(
          '<div class="west-toolkit-forts-container" style="height:100%"></div>'
        );
        var table = new west.gui.Table();
        table
          .addColumn("fortname")
          .addColumn("fortsize")
          .appendToCell("head", "fortname", TWBattleToolkit.lang.forts)
          .appendToCell("head", "fortsize", TWBattleToolkit.lang.fort_size);
        var forts = TWBattleToolkit.owned_forts.data[townId][type];
        for (var i = 0; i < forts.length; i++) {
          table.appendRow();
          table
            .appendToCell(
              i,
              "fortname",
              '<div class="anti_wrap"><a onclick="GameMap.center(' +
              forts[i].x +
              ", " +
              forts[i].y +
              ')" href="#"><img class="fortOverviewIconScroll hasMousePopup" src="images/icons/center.png"></a> <a href="javascript:void(FortWindow.open(' +
              forts[i].id +
              "," +
              forts[i].x +
              "," +
              forts[i].y +
              '));" class="hasMousePopup"> ' +
              forts[i].name +
              "</a></div>"
            )
            .appendToCell(
              i,
              "fortsize",
              TWBattleToolkit.lang.fort_sizes[forts[i].type]
            );
        }
        forts_container.html(table.getMainDiv());
        wman
          .open(
            "west-toolkit-forts-container",
            null,
            "west-toolkit-forts-container noreload nocloseall nominimize dontminimize"
          )
          .setTitle(TWBattleToolkit.lang.forts)
          .setMiniTitle(TWBattleToolkit.lang.forts)
          .appendToContentPane(forts_container)
          .setSize(340, 360);
      },
    },
  };

  TWBattleToolkit.init();
});
